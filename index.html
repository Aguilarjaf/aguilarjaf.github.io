<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Covid Vaccine API</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="styles.css">

    <!-- Load icon library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<body>
    <script>

        let population = null;
        let completedVaccines = null;
        let lastUpdated = null;

        function performCovidQuery() {

            let stateAbbrev = document.getElementById("stateInput").value;
            console.log(stateAbbrev);

            fetch("https://api.covidactnow.org/v2/state/" + stateAbbrev + ".json?apiKey=5fa78316f332478cbc3c19d10b6edb63")
                .then((response_data) => {
                    console.log(response_data)
                    return response_data.json();
                    // response_data.json().then((extra_data) => console.log(extra_data));
                    // console.log(parsed_data);
                })
                .then(parsed_data => {
                    console.log(parsed_data);

                    completedVaccines = parsed_data.actuals.vaccinationsCompleted;
                    population = parsed_data.population;
                    lastUpdated = parsed_data.lastUpdatedDate;
                    // window.location.href = "output.html";

                    document.getElementById("completed-vaccines").innerHTML = "Completed vaccines: " + completedVaccines;
                    document.getElementById("total-population").innerHTML = "Total population: " + population;
                    document.getElementById("percentage-vaxxed").innerHTML = "Percentage vaccinated: " + Math.round((completedVaccines / population) * 100) + "%";
                    document.getElementById("last-updated").innerHTML = "Last updated: " + lastUpdated;
                })
                .catch((error_data) => { console.log(error_data) })
                ;

            return false;

            // Example API: https://api.covidactnow.org/v2/state/WA.json?apiKey=5fa78316f332478cbc3c19d10b6edb63
            // const stateAbbrev = req.body.stateName;
            // const apiKey = "5fa78316f332478cbc3c19d10b6edb63";
            // const url = "https://api.covidactnow.org/v2/state/" + stateAbbrev + ".json?apiKey=" + apiKey;

            // https.get(url, (response) => {
            //     response.on("data", (data) => {
            //         const covidData = JSON.parse(data);

            //         const completedVaccines = covidData.actuals.vaccinationsCompleted;
            //         const totalPopulation = covidData.population;
            //         const lastUpdated = covidData.lastUpdatedDate;

            //         const percentVac = completedVaccines / totalPopulation;
            //         const formattedPercentage = Math.round(percentVac * 100);

            //         res.write("<h1>Completed vaccines in " + stateAbbrev + ": " + completedVaccines + "</h1>");
            //         res.write("<h1>Total Population: " + totalPopulation + "</h1>");
            //         res.write("<h1>Percentage Vaxxed: " + formattedPercentage + "%</h1>");
            //         res.write("<h2>Last updated on: " + lastUpdated + "</h2>");
            //         res.send();

            //     });
            // });
        };


    </script>

    <!-- Rendering content below -->
    <div class="hero-image">
        <div class="hero-text">
            <h1>Find Covid Vaccinations by State</h1>
            <form class="example" onsubmit="return performCovidQuery()">
                <!--label for="stateInput">State Name (Abbreviation): </label -->
                <input id="stateInput" type="text" name="stateName" placeholder="State Name (Abbreviation)">
                <input type="button" class="blue-button" value="Search Now" onclick="return performCovidQuery()">
            </form>

            <!-- <button class="blue-button" onclick="performCovidQuery()">Search <i class="fa fa-search"></i></button> -->

            <h2 id="completed-vaccines" class="info-label"></h2>
            <h3 id="total-population" class="info-label"></h3>
            <h3 id="percentage-vaxxed" class="info-label"></h3>
            <h3 id="last-updated" class="info-label"></h3>

        </div>
    </div>



</body>

</html>